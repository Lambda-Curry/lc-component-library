import { Meta, Story, Canvas, ArgsTable, Source } from '@storybook/addon-docs/blocks';
import { InputSelect, Form, InputText, ButtonOutline } from '../../..';
import dedent from 'string-dedent';
import './input-select-story.scss';

<Meta title="Input Select" component={InputSelect} />

# Input Select

<Canvas>
  <Story
    name="Input Select"
    parameters={{
      docs: {
        source: {
          code: dedent`
          <Form
            initialValues={{
              select: undefined,
              initialSelect: { label: 'Option 1', value: 1 },
              selectValueOnly: 2
            }}
            onSubmit={() => {}}
          >
            {formikProps => (
              <>
                <p className="lc-mb-8">Value: {JSON.stringify(formikProps.values.select)}</p>
                <InputSelect
                  label="Select Option"
                  name="select"
                  options={[
                    { label: 'Option 1', value: 1 },
                    { label: 'Option 2', value: 2 },
                    { label: 'Option 3', value: 3 }
                  ]}
                  formikProps={formikProps}
                />
                <p className="lc-mb-8">Value with initial form value: {JSON.stringify(formikProps.values.initialSelect)}</p>
                <InputSelect
                  label="Select Option"
                  name="initialSelect"
                  options={[
                    { label: 'Option 1', value: 1 },
                    { label: 'Option 2', value: 2 },
                    { label: 'Option 3', value: 3 }
                  ]}
                  formikProps={formikProps}
                />
                <p className="lc-my-8">
                  Value when <code>optionValueKey</code> is passed: {\`\${formikProps.values.selectValueOnly}\`}
                </p>
                <InputSelect
                  label="Select Option"
                  name="selectValueOnly"
                  optionValueKey="value"
                  options={[
                    { label: 'Option 1', value: 1 },
                    { label: 'Option 2', value: 2 },
                    { label: 'Option 3', value: 3 }
                  ]}
                  formikProps={formikProps}
                />
              </>
            )}
          </Form>`
        }
      }
    }}
  >
    <div className="input-select-story">
      <Form
        enableReinitialize={true}
        initialValues={{
          select: undefined,
          select_gray_bg: undefined,
          initialSelect: { label: 'Option 1', value: 1 },
          selectValueOnly: 2,
          inputText: ''
        }}
        onSubmit={() => {}}
      >
        {formikProps => (
          <>
            <ButtonOutline onClick={() => formikProps.resetForm()}>Reset</ButtonOutline>
            <p className="lc-mb-8">Value: {JSON.stringify(formikProps.values.select)}</p>
            <InputSelect
              label="Select Option"
              name="select"
              options={[
                { label: 'Option 1', value: 1 },
                { label: 'Option 2', value: 2 },
                { label: 'Option 3', value: 3 }
              ]}
              formikProps={formikProps}
            />
            <div className="lc-p-16 lc-bg-gray lc-text-white">
              <p className="lc-mb-8">Value: {JSON.stringify(formikProps.values.select_gray_bg)}</p>
              <InputSelect
                labelPlacement="above"
                label="Select Option"
                name="select_gray_bg"
                options={[
                  { label: 'Option 1', value: 1 },
                  { label: 'Option 2', value: 2 },
                  { label: 'Option 3', value: 3 }
                ]}
                formikProps={formikProps}
              />
            </div>
            <p className="lc-mb-8">Value with initial form value: {JSON.stringify(formikProps.values.initialSelect)}</p>
            <InputSelect
              label="Select Option"
              name="initialSelect"
              options={[
                { label: 'Option 1', value: 1 },
                { label: 'Option 2', value: 2 },
                { label: 'Option 3', value: 3 }
              ]}
              formikProps={formikProps}
            />
            <p className="lc-my-8">
              Value when <code>optionValueKey</code> is passed: {`${formikProps.values.selectValueOnly}`}
            </p>
            <InputSelect
              label="Select Option"
              name="selectValueOnly"
              optionValueKey="value"
              options={[
                { label: 'Option 1', value: 1 },
                { label: 'Option 2', value: 2 },
                { label: 'Option 3', value: 3 }
              ]}
              formikProps={formikProps}
            />
          </>
        )}
      </Form>
    </div>
  </Story>
  <Story
    name="Input Select with Custom Input Value"
    parameters={{
      docs: {
        source: {
          code: dedent`
          <Form enableReinitialize={true} initialValues={{ customValue: undefined }} onSubmit={() => {}}>
            {formikProps => (
              <>
                <p className="lc-my-8">Value: {\`\${formikProps.values.customValue}\`}</p>
                <InputSelect
                  label="Select Custom Value"
                  name="customValue"
                  options={[
                    { label: 'Option 1', value: 1 },
                    { label: 'Option 2', value: 2 },
                    { label: 'Option 3', value: 3 }
                  ]}
                  optionValueKey="value"
                  formikProps={formikProps}
                  autocompleteConfig={{
                    getOptionDisabled: option => option.isDisabled,
                    filterOptions: (options, params) => {
                      options.filter(({ value }) => value === undefined);
                      if (params.inputValue !== '') {
                        options.unshift({
                          value: params.inputValue,
                          label: \`Use "\${params.inputValue}"\`
                        });
                      }
                      return options;
                    },
                    getOptionLabel: option => {
                      if (typeof option === 'string') {
                        return option;
                      }
                      if (option.value && typeof option.value === 'string') {
                        return option.value;
                      }
                      return option.label;
                    },
                    renderOption: option => option.label
                  }}
                />
              </>
            )}
          </Form>`
        }
      }
    }}
  >
    {() => {
      return (
        <div className="input-form-story">
          <Form enableReinitialize={true} initialValues={{ customValue: undefined }} onSubmit={() => {}}>
            {formikProps => (
              <>
                <p className="lc-my-8">Value: {`${formikProps.values.customValue}`}</p>
                <InputSelect
                  label="Select Custom Value"
                  name="customValue"
                  options={[
                    { label: 'Option 1', value: 1 },
                    { label: 'Option 2', value: 2 },
                    { label: 'Option 3', value: 3 }
                  ]}
                  optionValueKey="value"
                  formikProps={formikProps}
                  autocompleteConfig={{
                    autoHighlight: true,
                    getOptionDisabled: option => option.isDisabled,
                    filterOptions: (options, params) => {
                      const filtered = [...options].filter(({ value }) => value !== undefined);
                      if (params.inputValue !== '') {
                        filtered.unshift({
                          value: params.inputValue,
                          label: `Use "${params.inputValue}"`
                        });
                      }
                      return filtered;
                    },
                    getOptionLabel: option => {
                      if (typeof option === 'string') {
                        return option;
                      }
                      if (option.value && typeof option.value === 'string') {
                        return option.value;
                      }
                      return option.label;
                    },
                    renderOption: option => option.label
                  }}
                />
              </>
            )}
          </Form>
        </div>
      );
    }}
  </Story>
  <ArgsTable of={InputSelect} />
</Canvas>
